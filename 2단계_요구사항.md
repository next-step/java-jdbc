🚨 힌트를 보기 전에 먼저 자신만의 방식으로 JdbcTemplate을 완성시켜본다.

실력을 쌓으려면 시행착오를 경험하는 과정이 필수다.

힘들더라도 이 과정을 건너뛰지 말자.

# **미션 설명**

자바가 제공하는 기능을 극한으로 활용해 클린 코드를 작성하는 연습을 한다.

- 익명 클래스
- 함수형 인터페이스
- 제네릭
- 가변 인자
- 람다
- try-with-resources
- checked vs unchecked exception

## **어떤 동작을 라이브러리로 만들까?**

| 동작 | JDBC 라이브러리 | 개발자 |
| --- | --- | --- |
| 연결 매개변수 설정 |  | ✅ |
| Connection 생성 | ✅ |  |
| SQL문 작성 |  | ✅ |
| SQL문의 매개변수와 값 설정 |  | ✅ |
| Statement 준비 및 실행 | ✅ |  |
| ResultSet 생성 | ✅ |  |
| ResultSet에서 데이터 추출 |  | ✅ |
| 예외 처리 | ✅ |  |
| 트랜잭션 관리 | ✅ |  |
| Connection, Statement, ResultSet 객체 close | ✅ |  |

어떻게 리팩터링 해야될지 잘 모르겠다면 다음 순서대로 진행해보자.

## **메서드 추출**

1. UserDao 클래스에서 insert 메서드를 참고해서 update 메서드를 구현한다.
2. update와 insert 메서드에서 사용자가 수정해야 되는 부분을 메서드로 분리한다.

https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/e663683eea974cc1aaa59e960ca7c4ee

## **클래스 추출**

1. 메서드를 분리하고 나면 update, insert 메서드에 중복된 코드가 보인다.
2. 각각 새로운 클래스로 분리해보자.
    1. UserDao에서 update 메서드와 관련된 코드를 UpdateJdbcTemplate 클래스를 만들어 이동시킨다.
    2. insert도 마찬가지로 InsertJdbcTemplate 클래스를 만들어 이동한다.
    3. UserDao에서 update, insert 각 메서드는 코드를 이동한 클래스를 사용하도록 수정한다.
    4. UpdateJdbcTemplate, InsertJdbcTemplate로 옮긴 메서드는 User, UserDao 객체를 의존하고 있다.

https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/156c7da71b5e4f8cbe5ba78378f34ff2

## **템플릿 메서드 패턴 적용**

1. UpdateJdbcTemplate, InsertJdbcTemplate 클래스도 중복된 코드가 보인다. 클래스를 하나만 남기고 제거한다.
2. 남은 클래스를 추상 클래스로 만든다. 사용자가 구현해야되는 부분은 추상 메서드로 만들어보자.
3. 클래스명, 메서드명을 범용적으로 쓸 수 있게 수정해보자.
4. UserDao도 변경한 클래스를 사용하도록 변경하자.

https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/ec740e4111ea43a7b9dfc1d060020bd2

## **도메인 의존도 제거**

1. UserDao에서 추상 클래스를 객체로 만들면 user 객체에 대한 의존도를 제거할 수 있다.

https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/31368681b4804e2f89b337d31587a54c

## **다시 한 번 클래스 추출**

1. select도 클래스로 추출 할 수 있지 않을까? SelectJdbcTemplate으로 분리해보자.
2. update, insert와 다르게 ResultSet를 사용해서 데이터 조회 결과를 객체로 매핑해야 한다.

https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/b1ff632490f54f799bcf0037ba6e1c6f

## **다시 한 번 템플릿 메서드 패턴 적용**

1. 분리하고 나니 SelectJdbcTemplate도 JdbcTemplate와 비슷한 부분이 많다. 두 클래스를 다시 합치자.

https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/c7b19bebd12847f2bf225cdd56f87808

## **불필요한 mapRow 메서드 제거**

1. update, insert는 mapRow 메서드가 불필요하다. findAll은 setValues 메서드가 불필요하다.
2. 불필요한 구현을 제거하기 위해 mapRow, setValues를 인터페이스로 분리해보자.

https://techcourse-storage.s3.ap-northeast-2.amazonaws.com/c5d29d742bc04711bdc54878f114881d

## **라이브러리 확장**

1. SQLException은 Checked Exception이다. 커스텀 Exception을 추가해서 사용자는 Unchecked Exception이 되도록 변경하자.
2. RowMapper 인터페이스는 Object를 반환하고 있어서 캐스팅이 사용된다. 제네릭을 사용하도록 개선해보자.
3. 매번 PreparedStatementSetter 인터페이스를 구현하려니 번거롭다. 가변인자를 사용해서 좀더 편리하게 만들 수 없을까?
4. 람다를 적극적으로 활용해서 코드량을 줄여보자.

---
## 요구사항 정리

[ ] readme.md 에 요구사항 작성하기
[ ] PreparedStatementParameterBinder 를 열거타입으로 개선한다
[ ] ResultSetColumnReader 를 열거타입으로 개선한다 
[ ] 